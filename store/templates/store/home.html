{% extends 'store/main.html' %}
{% load static %}
{% block content %}

<style>
    section {
        margin: 0 !important;
        padding: 0 !important;
    }

    .text-primary {
        color: #044993 !important;
    }

    .container,
    .container-fluid {
        padding: 0 !important;
        max-width: 1200px;
    }

    .full-width-section {
        height: auto;
        width: 100vw;
        overflow-x: hidden;
        margin: 0 !important;
        padding-left: 0 !important;
    }

    .carousel-item {
        padding: 30px;
    }

    .container-fluid {
        width: 100vw;
        max-width: 100%;
    }

    .form-control {
        border-radius: 10px;
        padding: 10px;
        border: 1px solid #ddd;
        font-size: 1rem;
    }

    .form-control:focus {
        border-color: #007bff;
        box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
    }

    .btn-primary {
        background-color: #044993;
        border: none;
        transition: background-color 0.3s ease, transform 0.3s ease;
    }

    .btn-primary:hover {
        background-color: #044993;
        transform: translateY(-3px);
    }

    .img-fluid {
        border-radius: 15px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }

    .reviews .carousel-inner {
        padding: 40px 0;
    }

    .carousel-custom-icon {
        width: 30px;
        height: auto;
    }

    .rotate-icon {
        transform: rotate(180deg);
    }

    .reviews h2 {
        font-weight: bold;
        color: #0f0f0f;
    }

    .reviews .carousel-inner p {
        font-size: 16px;
        color: #555;
    }

    .reviews .carousel-inner h5 {
        font-size: 18px;
        color: #222;
        margin-right: 10px;
    }

    .read-more-btn {
        font-weight: 500;
        font-size: 1rem;  
        text-decoration: underline;  
        transition: all 0.3s ease; 
        margin: 0 0 2rem;
        padding: 0;
        color: #0f0f0f;
    }

    .read-more-btn:hover {
        text-decoration: none;  
        color: #0f0f0f; 
    }

    #featured .new-title {
        color: #044993;
    }

    .treat-btn {
        font-family: DM Serif Text, serif;
        font-size: 1.2rem;
        text-decoration: none;
        background: #0f0f0f;
        color: #fff;
        padding: 1rem;
    }

    .image-holder img {
        max-width: 100%;  
        margin: 0 auto;    
        display: block;
        border-radius: 15px;
        margin-top: 4rem;
    }

    .carousel-inner {
        position: relative;
        width: 100%;
        overflow: hidden;
    }

    .carousel-img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover; 
        object-position: center; 
    }

    #products .card {
        height: 100%; 
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    #products .card-img-top {
        height: 25rem;
        object-fit: cover;
    }

    #products .card-body {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    #products .fixed-height-description {
        height: 60px; 
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 3; 
        -webkit-box-orient: vertical;
    }

    #blog .carousel-item img {
        height: 400px; 
        object-fit: cover; 
    }

    #blog .carousel {
        margin-right: 0; 
        margin-left: 0; 
    }

    #blog .blog-post {
        margin-bottom: 2rem; 
    }

    #blog .blog-post h4 {
        font-size: 1.5rem;
        font-weight: bold;
    }

    #blog .blog-post p {
        font-size: 1rem;
        line-height: 1.6;
        color: #555;
        text-align: justify;
    }

    #blog .blog-post a {
        color: #FF0961;
        text-decoration: none;
    }

    #blog .blog-post a:hover {
        text-decoration: underline;
    }

    #featured .container {
        margin: 5rem auto;
        max-width: 1200px; 
        text-align: left;
        gap: 2rem;
    }
    
    .product-image img {
        max-width: 100%;
        height: auto;
        object-fit: cover;
        width: 600px; 
        height: 600px;
    }

    .product-details-container {
        position: relative;
        padding: 2rem;
        border-radius: 8px;
        background-color: #fff;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    .product-details-container::after {
        content: 'Featured';
        position: absolute;
        top: 30px;
        right: -30px;
        background-color: #f39c12;
        color: #fff;
        padding: 5px 30px;
        font-weight: bold;
        font-size: 1.2rem;
        transform: rotate(45deg);
        box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
    }

    .product-details {
        padding: 1.5rem;
    }

    .product-details h2 {
        font-size: 1.75rem;
        font-weight: 600;
        display: flex;
        justify-content: left;
        gap: 0.5rem;
    }

    .product-details h1 {
        font-size: 2.5rem;
    }

    .product-details p {
        line-height: 1.6;
        font-size: 1rem;
    }

    .product-details button {
        font-size: 1.1rem;
        padding: 0.75rem 1.5rem;
    }

    @media (max-width: 768px) {
        #featured .row {
            flex-direction: column;
            gap: 2rem;
        }

        .product-image img {
            width: 100%;
            height: auto;
        }
    }

</style>

<section id="home" class="full-width-section text-dark d-flex align-items-center p-5" 
         style="min-height: 100vh; background-image: url({% static 'images/b-mango.png' %}); background-size: cover; background-position: center; transition: background 1s ease;">
    <div class="content-container d-flex justify-content-between align-items-center flex-wrap gap-3">
        <div class="text-container d-flex flex-column justify-content-center align-items-start text-start rounded p-4" 
             style="width: 45%; height: 55vh; color: #0f0f0f; margin-right: 4rem;">
            <h1 class="fw-semibold" style="font-size: 1.3rem; color: #0f0f0f;">GRAHAM & CO. DELIGHT</h1>
            <p class="lead fw-bold" style="font-family: DM Serif Text, serif; font-size: 4rem; color: #fff;">Happiness in <br> Every Layer</p>
            <p class="lead mb-4" style="font-size: 1.2rem;">Richly Made with Premium Ingredients, perfectly crafted with love.</p>
            <a href="#products" class="treat-btn btn-light btn-lg px-4 py-2 rounded-pill transition-transform hover-transform">Treat Yourself</a>
            
            <div class="d-flex justify-content-start align-items-center mt-2">
                <img src="{% static 'images/3 (2).png' %}" alt="Image 1" class="clickable-img" data-index="0" style="width: 30%; height: 80%; cursor: pointer; margin-right: -1rem;">
                <img src="{% static 'images/4 (1).png' %}" alt="Image 2" class="clickable-img" data-index="1" style="width: 40%; height: auto; cursor: pointer; margin-right: -2rem;">
                <img src="{% static 'images/2 (1).png' %}" alt="Image 3" class="clickable-img" data-index="2" style="width: 40%; height: auto; cursor: pointer;">
            </div>
        </div>

        <div class="image-container position-relative" style="width: 40%; height: 55vh; overflow: hidden;">
            <div class="carousel-wrapper" style="display: flex; transition: transform 1s ease;">
                <img src="{% static 'images/3 (2).png' %}" alt="Image 1" class="carousel-image image-1" style="object-fit: cover;">
                <img src="{% static 'images/4 (1).png' %}" alt="Image 2" class="carousel-image image-2" style="width: 100%; height: auto; object-fit: cover;">
                <img src="{% static 'images/2 (1).png' %}" alt="Image 3" class="carousel-image image-3" style="width: 100%; height: auto; object-fit: cover;">
            </div>
        </div>
    </div>
</section>

<style>
    .image-container {
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
    }

    .carousel-wrapper {
        display: flex;
        transition: transform 1s ease;
        width: 500%;
        margin-top: 5rem;
    }

    .carousel-image.image-1 {
        width: 700px; /* Adjust size for Image 1 */
    }

    .carousel-image.image-2 {
        width: 900px; /* Adjust size for Image 2 */
    }

    .carousel-image.image-3 {
        width: 100%; /* Adjust size for Image 3 */
    }
</style>
</style>

<script>
    const clickableImages = document.querySelectorAll('.clickable-img');
    const carouselWrapper = document.querySelector('.carousel-wrapper');
    const homeSection = document.querySelector('#home');

    const backgroundImages = [
        "{% static 'images/b-mango.png' %}",
        "{% static 'images/b-cnc.png' %}",
        "{% static 'images/b-straw.png' %}"
    ];

    clickableImages.forEach((image, index) => {
        image.addEventListener('click', () => {
            carouselWrapper.style.transform = `translateX(-${index * 100}%)`;
            homeSection.style.backgroundImage = `url(${backgroundImages[index]})`;
        });
    });
</script>

<section id="featured" class="full-width-section text-dark h-auto p-5" style="background-color: #fffafa;">
    <div class="container d-flex flex-column align-items-center justify-content-center my-2">
        <div class="row">
            {% if f %}
                <div class="col-lg-6 mb-4 d-flex justify-content-center">
                    <div class="product-image">
                        {% if f.image %}
                            <img src="{{ f.image.url }}" alt="{{ f.name }}" class="rounded larger-img" />
                        {% else %}
                            <img src="https://via.placeholder.com/500" alt="Featured Product" class="img-fluid rounded shadow-lg larger-img" />
                        {% endif %}
                    </div>
                </div>

                <div class="col-lg-6 pt-4">
                    <div class="product-details-container">
                        <div class="product-details text-left">
                            <h2 class="mb-4">
                                <span class="new-badge">New</span>
                                <span class="product-title" style="color: #044993;">PRODUCT!</span>
                            </h2>
                            
                            <h1 class="fw-bold mb-3" style="color: #044993;">{{ f.name }}</h1>
                            <p class="mb-4">{{ f.description }}</p>
                            <p class="h1 mb-4" style="font-size: 1.5rem;"><strong>Price:</strong> ${{ f.price }}</p>

                            <button class="btn btn-dark rounded px-4 py-3 add-to-cart-btn" data-product-id="{{ f.id }}">Add to Cart</button>
                        </div>
                    </div>
                </div>
            {% else %}
                <p>No featured product available at the moment.</p>
            {% endif %}
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const addToCartButtons = document.querySelectorAll('.add-to-cart-btn');

        addToCartButtons.forEach(button => {
            button.addEventListener('click', function () {
                const productId = this.getAttribute('data-product-id');
                const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

                fetch('/add-to-cart/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrftoken
                    },
                    body: JSON.stringify({ product_id: productId })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Product added to cart!');
                    } else {
                        alert('Failed to add product to cart.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred.');
                });
            });
        });
    });
</script>

<section id="products" class="full-width-section text-dark h-auto p-5" style="background-color: #fffafa;">
    <div class="container justify-content-center">
        <h3 class="center-text my-5 mb-4">Explore Our Top-Selling Graham <br> Everyone <span class="text-primary fw-bold">LOVES!</span></h3>
        <div class="container mt-5">
            <div class="row g-4">
                {% for product in products %}
                <div class="col-lg-4 col-md-6 col-sm-12">
                    <div class="card shadow-sm border-light rounded">
                        <img src="{{ product.imageURL }}" class="card-img-top" alt="{{ product.name }}">
                        <div class="card-body">
                            <h5 class="card-title">{{ product.name }}</h5>
                            <p class="card-text fixed-height-description">{{ product.description }}</p>
                            
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-success"><strong>${{ product.price }}</strong></h6>
                                    {% if product.quantity > 0 %}
                                        <span class="text-muted">Available: {{ product.quantity }}</span>
                                    {% else %}
                                        <span class="text-danger">Out of Stock</span>
                                    {% endif %}
                                </div>
                                <div>
                                    {% if product.quantity > 0 %}
                                        <button data-product="{{ product.id }}" data-action="add" class="btn btn-dark add-btn update-cart w-100 rounded">
                                            <img src="https://img.icons8.com/?size=100&id=RlNoi5xwjZXe&format=png&color=ffffff" alt="Cart Icon" style="width: 20px; height: 20px; margin-right: 8px;">
                                            Add to Cart
                                        </button>
                                    {% else %}
                                        <button class="btn btn-outline-secondary w-100" disabled>Out of Stock</button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>


<!-- Blog Section -->
<section id="blog" class="full-width-section bg-light text-dark h-auto">
    <h2 class="text-center my-5">Our latest <span class="fw-bold" style="color: #044993;">BLOG!</span> </h2>
    <div class="container my-5 gap-5" style="max-width: 1200px; margin: 0 auto;">
        
        <div class="row">
            <div class="col-md-6 mb-4 mb-md-0">
                <div class="ml-3" style="margin-left: 2rem;">
                    <h1 class="text-start mb-4 fw-bold">What's <span class="fw-bold" style="color: #044993;">NEW?</span></h1>
                    <p class="text-start mt-5">
                        Stay up to date with the latest news, trends, and updates from Graham Bar. Discover exciting new product launches, promotions, and insightful tips to enhance your shopping experience with us. Don't miss out on what's coming next!
                    </p>
                </div> 
                <div id="carouselExample" class="carousel slide mt-4" data-bs-ride="carousel" data-bs-interval="4000">
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <img src="{% static 'images/blog-1.jpg' %}" class="d-block w-100 img-fluid rounded" alt="Image 1">
                        </div>
                        <div class="carousel-item">
                            <img src="{% static 'images/blog-2.jpg' %}" class="d-block w-100 img-fluid rounded" alt="Image 2">
                        </div>
                        <div class="carousel-item">
                            <img src="{% static 'images/blog-3.jpg' %}" class="d-block w-100 img-fluid rounded" alt="Image 3">
                        </div>
                        <div class="carousel-item">
                            <img src="{% static 'images/blog-4.jpg' %}" class="d-block w-100 img-fluid rounded" alt="Image 3">
                        </div>
                        <div class="carousel-item">
                            <img src="{% static 'images/blog-5.jpg' %}" class="d-block w-100 img-fluid rounded" alt="Image 3">
                        </div>
                        <div class="carousel-item">
                            <img src="{% static 'images/blog-6.jpg' %}" class="d-block w-100 img-fluid rounded" alt="Image 3">
                        </div>
                        <div class="carousel-item">
                            <img src="{% static 'images/blog-7.jpg' %}" class="d-block w-100 img-fluid rounded" alt="Image 3">
                        </div>
                        <div class="carousel-item">
                            <img src="{% static 'images/blog-8.jpg' %}" class="d-block w-100 img-fluid rounded" alt="Image 3">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 mb-4 mb-md-0 ps-md-5">
                {% for blog in blogs|slice:":3" %}
                <div class="blog-post mb-4" 
                    {% if forloop.counter <= 2 %}
                    style="border-bottom: 2px solid #ddd; padding-bottom: 15px;"
                    {% endif %}
                >
                    <h4>{{ blog.title }}</h4>
                    <p>{{ blog.content|truncatewords:30 }}</p>
                    <a href="#" class="btn read-more-btn" style="color: #044993;">Read More</a>
                </div>
                {% empty %}
                <p class="text-muted">No blog posts available yet!</p>
                {% endfor %}
            </div>
        </div>
    </div>
</section>

<section id="reviews" class="reviews py-5 bg-light">
    <div class="container" style="max-width: 1200px; margin: 0 auto;">
        <div class="row align-items-start m-3">
            <div class="col-md-6 mb-4 mb-md-0">
                <h2 class="text-start mb-5 text-uppercase text-primary">Reviews</h2>
                <p class="fw-medium">Check out our customer reviews to see what others are saying about their experiences and why they love our products!</p>
            </div>
            <div class="col-md-6 p-0 m-0">
                <div id="reviewsCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">
                    <div class="carousel-inner p-0 m-0">
                        {% for review in reviews %}
                        <div class="carousel-item {% if forloop.first %}active{% endif %}">
                            <div class="text-start mb-5 fw-semibold">
                                <p >"{{ review.description }}"</p>
                            </div>
                            <div class="d-flex align-items-center">
                                <img src="https://img.icons8.com/?size=40&id=gouCEG68mCdY&format=png&color=044993" alt="Reviewer Image" class="rounded-circle me-2" style="width: 0.6rem; height: 0.6rem;">
                                <h5 class="mb-0">{{ review.name }}</h5>
                            </div>
                        </div>
                        {% empty %}
                        <p class="text-center text-muted">No reviews yet!</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section id="newsletter" class="full-width-section bg-light text-light h-auto">
    <div class="container my-5 px-5" style="max-width: 1300px;">

        <div class="row align-items-center">
            <div class="col-md-6 px-5">
                <div class="p-4">
                    <h4 class="text-muted mb-4 fw-semibold">
                        We’d <span class="text-primary">LOVE</span> to hear from you! If you have any questions, feedback, or just want to share your thoughts, feel free to reach out. Your input helps us <span class="text-primary">SERVE</span> you better!
                    </h4>
    
                    <a class="navbar-brand fs-4 text-primary fw-bold" href="{% url 'products' %}">Graham & Co.</a>
    
                    <form method="POST">
                        {% csrf_token %}
                        <div class="form-group my-3">
                            <input type="email" name="email" class="form-control" placeholder="Enter your email" required>
                        </div>
                        <button type="submit" class="btn btn-dark w-100 py-2">Subscribe</button>
                    </form>
                </div>
            </div>
            <div class="col-md-6 text-center">
                <img src="{% static 'images/bg-news.png' %}" alt="Newsletter Image" class="img-fluid rounded shadow" style="max-width: 100%; height: auto;">
            </div>
        </div>
    </div>
</section>

<footer class="bg-dark text-light pt-4 pb-2 full-width-section h-auto">
    <div class="container">
        <div class="row">
            <div class="col-md-4">
                <h5 class="fw-bold mb-3" style="color: #FDFA9F;">Graham & Co.</h5>
                <p class="small" style="font-size: 0.7rem;">Your trusted source for the best products and exceptional customer service. Stay connected with us for updates and exclusive offers.</p>
                <ul class="list-unstyled">
                    <li><a href="#" class="text-light">Terms of Service</a></li>
                    <li><a href="#" class="text-light">Privacy Policy</a></li>
                </ul>
            </div>
            <div class="col-md-4">
                <h5 class="fw-bold mb-3" style="color: #FDFA9F;">Quick Links</h5>
                <ul class="list-unstyled">
                    <li><a href="/#home" class="text-light">Home</a></li>
                    <li><a href="/#products" class="text-light">Products</a></li>
                    <li><a href="/#blog" class="text-light">Blog</a></li>
                    <li><a href="/#newsletter" class="text-light">Newsletter</a></li>
                </ul>
            </div>
            <div class="col-md-4">
                <h5 class="fw-bold mb-3" style="color: #FDFA9F;">Follow Us</h5>
                <ul class="list-unstyled d-flex">
                    <li><a href="#" class="text-light me-3"><i class="bi bi-facebook" style="font-size: 1rem;"><img src="https://img.icons8.com/?size=30&id=118466&format=png&color=ffffff"></i></a></li>
                    <li><a href="#" class="text-light me-3"><i class="bi bi-twitter" style="font-size: 1rem;"><img src="https://img.icons8.com/?size=30&id=YfCbGWCWcuar&format=png&color=ffffff"></i></i></a></li>
                    <li><a href="#" class="text-light me-3"><i class="bi bi-instagram" style="font-size: 1rem;"><img src="https://img.icons8.com/?size=30&id=32309&format=png&color=ffffff"></i></i></a></li>
                    <li><a href="#" class="text-light me-3"><i class="bi bi-email" style="font-size: 1rem;"><img src="https://img.icons8.com/?size=30&id=Y2GfpkgYNp42&format=png&color=ffffff"></i></i></a></li>
                </ul>
            </div>
        </div>
        <div class="text-center pt-3">
            <p class="small mb-0">&copy; 2024 Graham & Co. All Rights Reserved.</p>
        </div>
    </div>
</footer>

<script>
    document.querySelectorAll('.update-cart').forEach(button => {
        button.addEventListener('click', function() {
            const productId = this.dataset.product;
            const action = this.dataset.action;
            const quantityInput = document.getElementById('quantity-' + productId);
            
            if (!quantityInput) {
                console.error('Quantity input not found for product ' + productId);
                return;
            }

            const quantity = parseInt(quantityInput.value);

            console.log(`Product ID: ${productId}, Action: ${action}, Quantity: ${quantity}`); 

            if (!quantity || quantity <= 0) {
                alert('Please enter a valid quantity.');
                return;
            }

            fetch('/update_item/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                },
                body: JSON.stringify({
                    'productId': productId,
                    'action': action,
                    'quantity': quantity
                }),
            })
            .then(response => response.json())
            .then(data => {
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
    });
</script>
{% endblock content %}
